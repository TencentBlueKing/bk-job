### Function Description

Query step execution status by step instance ID

### Request Parameters

#### Interface parameters

| Fields                 | Type   | Required | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|------------------------|--------|----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| bk_scope_type          | string | yes      | Resource scope type. Optional values: biz - Business，biz_set - Business Set                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| bk_scope_id            | string | yes      | Resource scope ID. Corresponds to bk_scope_type, which means business ID or business set ID                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| job_instance_id        | long   | yes      | Job instance ID                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| step_instance_id       | long   | yes      | Step instance ID                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| execute_count          | int    | no       | The number of retry attempts starts from 0, and not passing means obtaining the data from the most recent retry.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| batch                  | int    | no       | Rolling batches, counting from 0, default value is null to retrieve data for all batches.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| max_host_num_per_group | int    | no       | The maximum number of hosts in each group (grouped by status and tag), and if not transmitted, return the full amount of data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| keyword                | string | no       | Log search keyword, only return the execution status data of the host containing the keyword in the log (note: only script steps support)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| search_ip              | string | no       | Host IP/IPv6 search keywords, only return the execution status data of hosts whose IP/IPv6 addresses contain the keyword                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| status                 | int    | no       | Execution status, corresponding to the status field in the return value, will only return the host execution status data under the execution status matching group, and only return basic grouping information such as the number of hosts under other groups. Possible values: 0- Unknown error, 1- Agent exception, 2- Invalid host, 3- Last successful, 5- Waiting for execution, 7- Executing, 9- Execution successful, 11- Execution failed, 12- Task issuance failed, 13- Task timeout, 15- Task log error, 16- GSE script log timeout, 17- GSE file log timeout, 101- Script execution failure, 102- Script execution timeout, 103- Script execution terminated, 104- Script return code non-zero, 202- File transfer failure, 203- Source file does not exist, 301- File task system error - Unclassified, 303- File task timeout, 310- Agent exception, 311- Username does not exist, 312- User password error, 320- File retrieval failure 321- File exceeds limit, 329- File transfer error, 399- Task execution error, 403- Task forced termination successful, 404- Task forced termination failed, 500- Unknown status |
| tag                    | string | no       | Result tag, corresponding to the tag field in the return value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |

### Example of request

- GET

```json
/api/v3/get_step_instance_status?bk_scope_type=biz&bk_scope_id=1&job_instance_id=100&step_instance_id=100&execute_count=0&batch=0&max_host_num_per_group=1&keyword=aaa&search_ip=&status=9&tag=
```

### Example of responses

```json
{
  "result": true,
  "code": 0,
  "message": "",
  "data": {
    "step_instance_id": 75,
    "execute_count": 0,
    "name": "API Quick execution scriptxxx",
    "type": 1,
    "status": 4,
    "create_time": 1605064271000,
    "start_time": 1605064271000,
    "end_time": 1605064272000,
    "total_time": 1000,
    "step_result_group_list": [
      {
        "result_type": 9,
        "result_type_desc": "执行成功",
        "tag": "tag1",
        "host_size": 2,
        "host_result_list": [
          {
            "bk_host_id": 101,
            "ip": "127.0.0.1",
            "ipv6": null,
            "bk_agent_id": null,
            "bk_cloud_id": 0,
            "bk_cloud_name": "Default Area",
            "status": 9,
            "status_desc": "执行成功",
            "tag": "tag1",
            "exit_code": 0,
            "start_time": 1605064271000,
            "end_time": 1605064272000,
            "total_time": 1000
          }
        ]
      },
      {
        "result_type": 9,
        "result_type_desc": "执行成功",
        "tag": "tag2",
        "host_size": 2,
        "host_result_list": [
          {
            "bk_host_id": 102,
            "ip": "127.0.0.2",
            "ipv6": null,
            "bk_agent_id": null,
            "bk_cloud_id": 0,
            "bk_cloud_name": "Default Area",
            "status": 9,
            "status_desc": "执行成功",
            "tag": "tag2",
            "exit_code": 0,
            "start_time": 1605064271000,
            "end_time": 1605064272000,
            "total_time": 1000
          }
        ]
      }
    ]
  }
}
```

### Response Description

{% include '_generic_response.md.j2' %}

##### data

| Fields                 | Type                    | Required | Description                                                                                                                                                                                                                                                                   |
|------------------------|-------------------------|----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| step_instance_id       | long                    | yes      | Step instance id                                                                                                                                                                                                                                                              |
| execute_count          | int                     | yes      | Step retry times                                                                                                                                                                                                                                                              |
| name                   | string                  | yes      | Step name                                                                                                                                                                                                                                                                     |
| type                   | int                     | yes      | Type                                                                                                                                                                                                                                                                          |
| status                 | int                     | yes      | Job step status code: 1- Not executed, 2- Executing, 3- Successful execution, 4- Failed execution, 5- Skip, 6- Ignore error, 7- Waiting for user, 8- Manual end, 9- Abnormal status, 10- Forced termination, 11- Forced termination successful, 12- Forced termination failed |
| create_time            | long                    | yes      | Task step instance creation time, Unix timestamp, in milliseconds                                                                                                                                                                                                             |
| start_time             | long                    | yes      | Start time，Unix timestamp, in milliseconds                                                                                                                                                                                                                                    |
| end_time               | long                    | yes      | End time，Unix timestamp, in milliseconds                                                                                                                                                                                                                                      |
| total_time             | int                     | yes      | Total time consumption, in milliseconds                                                                                                                                                                                                                                       |
| step_result_group_list | list<step_result_group> | yes      | Task execution result grouping list，see step_result_group definition                                                                                                                                                                                                          |

##### step_result_group

| Fields           | Type              | Required | Description                                                                      |
|------------------|-------------------|----------|----------------------------------------------------------------------------------|
| result_type      | int               | yes      | Group type                                                                       |
| result_type_desc | string            | yes      | Group type describe                                                              |
| tag              | string            | yes      | Tag                                                                              |
| host_size        | int               | yes      | Total number of hosts within the group                                           |
| host_result_list | list<host_result> | yes      | List of host task execution results within each group，see host_result definition |

##### host_result

| Fields        | Type   | Required | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|---------------|--------|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| bk_host_id    | long   | yes      | Host ID                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| ip            | string | no       | IP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| ipv6          | string | no       | IPv6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| bk_agent_id   | string | no       | AgentId                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| bk_cloud_id   | long   | no       | Area ID                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| bk_cloud_name | string | no       | Area name                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| status        | int    | yes      | Task status: 0- Unknown error, 1- Agent exception, 2- Invalid host, 3- Last successful, 5- Waiting for execution, 7- Executing, 9- Execution successful, 11- Execution failed, 12- Task issuance failed, 13- Task timeout, 15- Task log error, 16- GSE script log timeout, 17- GSE file log timeout, 101- Script execution failed, 102- Script execution timeout, 103- Script execution terminated, 104- Script return code non-zero, 202- File transfer failed, 203- Source file does not exist, 301- File task system error - Unclassified, 303- File task timeout, 310- Agent exception, 311- Username does not exist, 312- User password error, 320- File retrieval failed. 321- File exceeds limit, 329- File transfer error, 399- Task execution error, 403- Task forced termination successful, 404- Task forced termination failed, 500- Unknown status |
| status_desc   | string | yes      | Status describe                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| tag           | string | no       | The user customizes the output results through the job_Success/job_fail function template. Only script tasks have this parameter present                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| exit_code     | int    | no       | Script exit code                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| start_time    | long   | yes      | Start time，Unix timestamp, in milliseconds                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| end_time      | long   | yes      | End time，Unix timestamp, in milliseconds                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| total_time    | int    | yes      | Total time consumption, in milliseconds                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
